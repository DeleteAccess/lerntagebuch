---
title: "Tag 7"
date: 2021-12-03
---

Heute hat sich gezeigt, dass die Gedulg sich ausgezahlt hat, denn der Schwerpunkt lag auf **OpenRefine**.

## OpenRefine

#### Claim von OpenRefine

>  "A free, open source, powerful tool for working with messy data"

* grafische Oberfläche, die einer klassischen Tabellenverarbeitungssoftware ähnelt
* dient der Analyse, Bereinigung, Konvertierung und Anreicherung von Daten
* wird in der Regel lokal auf einem Computer installiert und über den Browser bedient*1

***1 da hat und geholfen, denn bei einigen war die VM langsam und Herr Lohmeier konnte dann kurzerhand einen Server aufsetzen, für diese Personen.***

#### Einsatzbereiche

![OpenRefine 2020 Survey Results: Tasks](https://raw.githubusercontent.com/OpenRefine/openrefine.github.com/master/images/2020survey/4.png)

Note:
- Aus Umfrage vom OpenRefine-Team, n = 178

#### Von OpenRefine unterstützte Formate

* Besonders geeignet für tabellarische Daten (CSV, TSV, XLS, XLSX und auch TXT mit Trennzeichen oder festen Spaltenbreiten)
* Einfaches "flaches" XML (z.B. MARCXML) oder JSON ist mit etwas Übung noch relativ einfach zu modellieren
* Komplexes XML mit Hierarchien (z.B. EAD) ist möglich, aber nur mit Zusatztools
* Kann auch [in Kombination mit MarcEdit](https://blog.reeset.net/archives/1873) für Analyse und Transformation von MARC21 benutzt werden


OpenRefine hat [eine vorbildliche Open-Source Community ](https://github.com/OpenRefine/OpenRefine/graphs/contributors) (ganz anders als Marc Edit, wo wir am Abend davor gesehen haben).

---

### Installation OpenRefine 3.5.0 & Laden erster Daten

Mit dem ```wget``` Befehl konnten wir wieder eimmal die Software herunterladen. (``` wget https://github.com/OpenRefine/OpenRefine/releases/download/3.5.0/openrefine-linux-3.5.0.tar.gz```)
    
Mit ``` tar -xzf``` können wir die Datei entpacken. 

Nachdem wir OpenRefine installiert haben, und mittels ```./refine``` (vom entpackten Verzeichnis aus) gestartet haben, können wir unter http://localhost:3333 OpenRefine darauf zugreifen. Nach etwa sechs Sekunden ist OpenRefine verfügbar.

Praktischerweise können wir Daten auch über URL laden, mit der Option **Web Addresses (URL)**
Für die Übung benutzten wir: https://raw.githubusercontent.com/LibraryCarpentry/lc-open-refine/gh-pages/data/doaj-article-sample.csv

Das Laden dauerte nicht mehr als zwei Sekunden und schon werden diese als Tabelle dargestellt.

### Basisfunktionen 

**Facet / Filter:** "to select subsets of your data to act on"

Man kann einstesllen, wie viele Rows man sehen möchte. Ich könnte mir tatsächlich vorstellen, das auch in Zukunft zu benutzen, wenn ich ellenlange Excel Files zu bearbeiten / bewerten habe.

**Text Facet:** bei Spalte "Language" > Facet > Text Facet

![screenshot Text Facet](../img/screenshot-text-facet.png)

werden dann links angezeigt und können ausgewählt werden.

Wir hatten z.B. den Umstand, dass beides "English" und "EN" steht. Glücklicherweise kann man direkt auf *edit* klicken, und bei allen 107 Zeilen anpassen lassen.

"Komplexere Regeln, wie getrennt wird:" Authors > Edit cells > Split multi-valued cells ; in diesem Fall jetzt "|" für die Authrennamen (von 1001 Zeilen zu 4009). Die Werte der restlichen Felder dieser Zeile werden jedoch nicht mitübernommen, d.h. wenn mehrere Autoren in einer Reihe sind, wird nur der erste mit den anderen Angaben stehen und die restlichen Autoren haben (abgesehen von ihrem Namensfeld) eine leere Reihe.
Das kann mit "Spalte Authors > Edit cells > Join multi-valued cells… > Separator: |" wieder behoben werden.
Soweit ich das verstanden habe, und weil wir die Reihen ja auch wieder korrekt zusammensetzen können, wird das beim Splitten ein "into a multi-row record"  gemacht.

Mit dem **Cluster** Button können wir die Autorennamen mergen, d.h. dass die Software ähnliche Namen gruppiert und für alle den gleichen Namen definiert. Dieser Prozess kann iterativ durchgemacht werden mit dem Button **Merge Selected & Re-Cluster**.

Mehr dazu in der OpenRefine Doku: https://docs.openrefine.org/manual/cellediting#cluster-and-edit

Als wir mit ```value.split(",")[0]``` aus dem *Citation* Feld den ersten Wert (das Journal) als neues Feld in allen Reihen hinzugefügt haben, war ich beeindruckt. Solche Möglichkeiten machen OpenRefine nochmals um einige Gradienten wertvoller für mich / für meine Use Cases (dann überrascht es mich nicht, dass "Data Science" als eine der Andwendungen genannt worden ist bei [OpenRefine 2020 Survey Results: Communities](https://raw.githubusercontent.com/OpenRefine/openrefine.github.com/master/images/2020survey/1.png)).

---

### Übung: CSV nach MARCXML mit OpenRefine

#### Templating Export

Im **Row Template** sind einige Funktionen mit der Template-Sprache **GREL** gegeben:

* Mit ```value.replace('https://doaj.org/article/','')``` ausser dem Identifier (MARC 001) wird die URL gelöscht
* Mit ```value.escape('xml')``` werden Sonderszeichen ins entsprechende XML-Zeichen übersetzt (z.B. {{"&".escape('xml)}} macht das ```&``` Zeichen zu ```&amp;```) 
* Mit ```['Authors'].value.split('|').slice(1)``` werden die Autoren aufgeteilt (wie oben) und alles vor dem zweiten Wert (```slice(1)```) wird vom Datensatz weggenommen

#### Aufgabe 3: Validieren mit xmllint

* Wir exportieren das Gesamtergebnis als XML-Datei.
  * Tipp: Firefox speichert Datei im Downloads-Ordner als .txt. Ordner Downloads aufrufen und Ende umbenennen in .xml
* Für die Validierung können Sie das Programm `xmllint` verwenden, das unter Ubuntu vorinstalliert ist.
* Zum Abgleich gegen das offizielle Schema von MARC21 laden wir dieses (XSD) zunächst herunter.

```shell
cd ~/Downloads
wget https://www.loc.gov/standards/marcxml/schema/MARC21slim.xsd
xmllint doaj-article-sample-csv.xml --noout --schema MARC21slim.xsd
```

Die Antwort ``` doaj-article-sample-csv.xml validates``` bedeutet, dass alles okay ist.
